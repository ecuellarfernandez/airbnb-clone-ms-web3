<div class="search-filter-container">

    <div class="search-pill" *ngIf="compact && !isExpanded">
        <!-- Dónde -->
        <button class="pill-section" (click)="expandAndOpen('location')">
            <span class="pill-title">Dónde</span>
            <span class="pill-subtitle">
                {{ filters.location || 'Explora destinos' }}
            </span>
        </button>

        <span class="pill-divider"></span>

        <!-- Fechas -->
        <button class="pill-section" (click)="expandAndOpen('dates')">
            <span class="pill-title">Fechas</span>
            <span class="pill-subtitle">
                {{ dateText === 'Any week' ? 'Agrega fechas' : dateText }}
            </span>
        </button>

        <span class="pill-divider"></span>

        <!-- Quién -->
        <button class="pill-section pill-section-guests" (click)="expandAndOpen('guests')">
            <span class="pill-title">Quién</span>
            <span class="pill-subtitle">
                {{ guestText === 'Add guests' ? '¿Cuántos?' : guestText }}
            </span>
        </button>

        <div class="search-icon-wrapper" (click)="expandAndOpen('location')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5"
                stroke="currentColor" class="search-icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196
             a7.5 7.5 0 0010.607 10.607z" />
            </svg>
        </div>
    </div>


    <!-- Expanded State (Full Filter Bar) -->
    <div class="search-bar-expanded" *ngIf="isExpanded"> <!---->
        <div class="filter-fields">
            <!-- Location Field -->
            <div class="filter-field" (click)="openLocationModal()">
                <label class="field-label">Dónde</label>
                <input type="text" class="field-input" [value]="filters.location" placeholder="Explora destinos"
                    readonly />
            </div>

            <div class="field-divider"></div>

            <!-- Dates Field -->
            <div class="filter-field" (click)="openDateModal()">
                <label class="field-label">Fechas</label>
                <input type="text" class="field-input" [value]="dateText === 'Any week' ? '' : dateText"
                    placeholder="Agrega fechas" readonly />
            </div>

            <div class="field-divider"></div>

            <!-- Guests Field -->
            <div class="filter-field filter-field-guests" (click)="openGuestModal()">
                <label class="field-label">Quién</label>
                <input type="text" class="field-input" [value]="guestText === 'Add guests' ? '' : guestText"
                    placeholder="¿Cuántos?" readonly />
            </div>

            <!-- Search Button -->
            <button class="search-btn" [class.search-btn-compact]="!hasActiveFilter" (click)="onSearch()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5"
                    stroke="currentColor" class="btn-icon">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                <span *ngIf="hasActiveFilter">Buscar</span>
            </button>
        </div>
    </div>
</div>

<!-- Backdrop for expanded state -->
<div class="search-backdrop" *ngIf="compact && isExpanded" (click)="collapse()"></div>

<!-- Modals -->
<app-location-search [isOpen]="isLocationModalOpen" [selectedLocation]="filters.location"
    (locationSelect)="onLocationSelect($event)" (close)="closeModals()"></app-location-search>

<app-date-picker [isOpen]="isDateModalOpen" [dateRange]="dateRange" variant="search"
    (dateRangeChange)="onDateRangeChange($event)" (close)="closeModals()"></app-date-picker>

<app-guest-selector [isOpen]="isGuestModalOpen" [guests]="guestCounts" variant="search"
    (guestsChange)="onGuestsChange($event)" (close)="closeModals()"></app-guest-selector>