<div class="card">
  <header class="cardHeader">
    <h2>Alojamientos</h2>

    <div class="header-actions"></div>
  </header>

  <table>
    <thead>
      <tr>
        <th>Título</th>
        <th>Ciudad</th>
        <th>País</th>
        <th>Precio</th>
        <th>Estado</th>
        <th style="width: 200px">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let listing of listings$ | async" class="clickable-row" (click)="openDetail(listing)">
        <td>
          <strong>{{ listing.title }}</strong>
        </td>
        <td class="muted">{{ listing.city }}</td>
        <td class="muted">{{ listing.country }}</td>
        <td>{{ listing.priceAmount | currency : listing.priceCurrency }}</td>
        <td>
          <span class="badge" [class.active]="listing.active" [class.inactive]="!listing.active">
            {{ listing.active ? 'Activo' : 'Inactivo' }}
          </span>
        </td>
        <td class="row-actions" (click)="$event.stopPropagation()">
          <button *ngIf="listing.active" (click)="toggleStatus(listing)" class="small danger">
            Desactivar
          </button>
          <button *ngIf="!listing.active" (click)="toggleStatus(listing)" class="small success">
            Publicar
          </button>
          <button (click)="remove(listing)" class="small danger">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Empty state -->
  <div *ngIf="(listings$ | async)?.length === 0" class="empty-state">
    <p>No se encontraron alojamientos</p>
  </div>

  <!-- Paginación -->
  <div *ngIf="(listings$ | async)?.length" class="pagination">
    <div class="pagination-info">
      Mostrando {{ currentPage * pageSize + 1 }} -
      {{ Math.min((currentPage + 1) * pageSize, totalElements) }} de
      {{ totalElements }} alojamientos
    </div>

    <div class="pagination-controls">
      <button (click)="previousPage()" [disabled]="currentPage === 0" class="btn-pagination">
        ← Anterior
      </button>

      <span class="page-indicator"> Página {{ currentPage + 1 }} de {{ totalPages }} </span>

      <button (click)="nextPage()" [disabled]="isLastPage" class="btn-pagination">
        Siguiente →
      </button>
    </div>

    <div class="page-size-selector">
      <label>
        Mostrar
        <select [value]="pageSize" (change)="onPageSizeChange($any($event.target).value)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
        por página
      </label>
    </div>
  </div>
</div>

<div class="modal" *ngIf="showForm" (click)="showForm = false">
  <div class="modal-body" (click)="$event.stopPropagation()">
    <app-listing-form [value]="editing" (cancel)="showForm = false" (submitForm)="save($event)">
    </app-listing-form>
  </div>
</div>

<!-- Modal de confirmación de cambio de estado -->
<app-confirmation-modal
  [isOpen]="showConfirmModal"
  [title]="confirmModalTitle"
  [message]="confirmModalMessage"
  [confirmText]="confirmModalAction === 'unpublish' ? 'Desactivar' : 'Publicar'"
  cancelText="Cancelar"
  [isDanger]="confirmModalAction === 'unpublish'"
  (confirm)="onConfirmStatusChange()"
  (cancel)="closeConfirmModal()"
></app-confirmation-modal>

<!-- Modal de detalle del listing -->
<div class="modal detail-modal" *ngIf="showDetailModal" (click)="closeDetailModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Detalle del Alojamiento</h2>
      <button class="close-btn" (click)="closeDetailModal()">×</button>
    </div>
    
    <div class="modal-body" *ngIf="detailListing">
      <!-- Imagen principal -->
      <div class="detail-image" *ngIf="detailListing.primaryImageUrl || detailListing.image">
        <img [src]="detailListing.primaryImageUrl || detailListing.image" [alt]="detailListing.title">
      </div>
      
      <!-- Información principal -->
      <div class="detail-info">
        <div class="detail-header">
          <h3>{{ detailListing.title }}</h3>
          <span class="badge" [class.active]="detailListing.active" [class.inactive]="!detailListing.active">
            {{ detailListing.active ? 'Activo' : 'Inactivo' }}
          </span>
        </div>
        
        <div class="detail-grid">
          <div class="detail-item">
            <span class="label">ID</span>
            <span class="value id-value">{{ detailListing.id }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Ubicación</span>
            <span class="value">{{ detailListing.city }}<span *ngIf="detailListing.country">, {{ detailListing.country }}</span></span>
          </div>
          
          <div class="detail-item">
            <span class="label">Precio por noche</span>
            <span class="value price">{{ detailListing.priceAmount || detailListing.price | currency : (detailListing.priceCurrency || 'USD') }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Capacidad</span>
            <span class="value">{{ detailListing.capacity }} {{ detailListing.capacity === 1 ? 'huésped' : 'huéspedes' }}</span>
          </div>
        </div>
        
        <div class="detail-description" *ngIf="detailListing.description">
          <span class="label">Descripción</span>
          <p>{{ detailListing.description }}</p>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDetailModal()">Cerrar</button>
    </div>
  </div>
</div>